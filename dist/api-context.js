"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const string_utils_1=__importDefault(require("@bizhermit/basic-utils/dist/string-utils")),message_context_1=__importDefault(require("./message-context"));class ApiContext extends message_context_1.default{req;res;constructor(e,s){super(),this.req=e,this.res=s,null==this.req.session&&(this.req.session=global._session??{})}getRequest(){return this.req}getResponse(){return this.res}getMethod(){return this.req.method||""}getParams(){return this.req.body}getQuery(e){return this.req.query?.[e]}getCookie(e){return this.req.cookies?.[e]}getSessionID(){return this.req.sessionID??""}getSession(e){return string_utils_1.default.isNullOrEmpty(e)?null:this.req.session[e]}setSession(e,s){return string_utils_1.default.isNullOrEmpty(e)||(this.req.session[e]=s),this}clearSession(e){return string_utils_1.default.isNullOrEmpty(e)?Object.keys(this.req.session).forEach((e=>{this.clearSessionByKey(e)})):this.clearSessionByKey(e),this}clearSessionByKey(e){"regenerate"!==e&&delete this.req.session[e]}regenerateSession(e){return new Promise(((s,t)=>{try{const t={};!0===e&&Object.keys(this.req.session).forEach((e=>{t[e]=this.req.session[e]}));const r=()=>{Object.keys(t).forEach((e=>{this.req.session[e]=t[e]}))};if(this.req.session.regenerate&&"function"==typeof this.req.session.regenerate)return void this.req.session.regenerate((()=>{r(),s(this)}));this.clearSession(),r(),s(this)}catch(e){t(e)}}))}setData(e){return this.res.json({data:e??{},messages:this.getMessages()}),this}setStatus(e){this.res.status(e)}done(e={},s,t){this.doneAs(200,e,s,t)}doneAs(e,s={},t,r){string_utils_1.default.isNotNullOrEmpty(t)&&this.addInformation(t,r),this.setData(s).setStatus(e??200)}error(e){e&&this.addError(String(e)),this.setData({}).setStatus(500)}}exports.default=ApiContext;